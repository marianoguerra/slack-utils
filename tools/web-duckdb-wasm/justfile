# web-duckdb-wasm justfile

# Default recipe to list available targets
default:
    @just --list

# Install dependencies
install:
    bun install

# Build the app bundle (minified)
build:
    bun run build

# Clean dist folder
clean:
    rm -rf dist

# Full rebuild
rebuild: clean install build

# ─────────────────────────────────────────────────────────────────────────────
# Development Servers
# ─────────────────────────────────────────────────────────────────────────────

# Start the dev server with API endpoints (compatible with slack-archive-server)
# Requires parquet files at the specified path
serve path="." port="3000":
    bun serve.js --path {{path}} --port {{port}}

# Start with hot reload
dev path="." port="3000":
    bun --hot serve.js --path {{path}} --port {{port}}

# Start static file server (for pre-built deployments)
serve-static path="." port="3000":
    bun static-file-server.js --path {{path}} --port {{port}}

# ─────────────────────────────────────────────────────────────────────────────
# Static Export
# ─────────────────────────────────────────────────────────────────────────────

# Export a self-contained static UI with parquet files for static hosting
# Creates dist/static-ui/ with everything needed for deployment
export-static-ui path:
    ./scripts/export-static-ui.sh {{path}}

# ─────────────────────────────────────────────────────────────────────────────
# Testing with slack-archive-server
# ─────────────────────────────────────────────────────────────────────────────

# Serve this app via slack-archive-server (tests full API compatibility)
serve-with-server base_path="." port="8080":
    ./scripts/serve-with-server.sh {{base_path}} {{port}}
