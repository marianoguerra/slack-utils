# slack-archive-client justfile

# Default recipe to list available targets
default:
    @just --list

# Install dependencies
install:
    bun install

# Build the library (ESM + TypeScript declarations)
build:
    bun run build

# Build types only
build-types:
    bun run build:types

# Type check without emitting
typecheck:
    bun run typecheck

# Clean dist folder
clean:
    bun run clean

# Full rebuild (clean + install + build)
rebuild: clean install build

# Run all checks (typecheck + build)
check: typecheck build

# ─────────────────────────────────────────────────────────────────────────────
# Development Server (web-duckdb-wasm)
# ─────────────────────────────────────────────────────────────────────────────

web_app_dir := "../web-duckdb-wasm"

# Start the web-duckdb-wasm dev server for testing the client
# Requires parquet files at the specified path
serve-test-ui path="." port="3000":
    cd {{web_app_dir}} && bun install && bun serve.js --path {{path}} --port {{port}}

# Start the web-duckdb-wasm dev server with hot reload
dev-test-ui path="." port="3000":
    cd {{web_app_dir}} && bun install && bun --hot serve.js --path {{path}} --port {{port}}

# Build the web-duckdb-wasm app
build-test-ui:
    cd {{web_app_dir}} && bun install && bun run build

# ─────────────────────────────────────────────────────────────────────────────
# Testing with slack-archive-server
# ─────────────────────────────────────────────────────────────────────────────

# Start slack-archive-server with web-duckdb-wasm as static assets
# This tests the full stack: server API + DuckDB client + web UI
serve-with-server base_path="." port="8080":
    ./scripts/serve-with-server.sh {{base_path}} {{port}} {{web_app_dir}}
